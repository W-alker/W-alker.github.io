<!DOCTYPE html>


<html lang="en">


<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="路修远,博客,ayer,学习笔记,前端,萌新" />
   
  <meta name="description" content="路修远个人博客,前端萌新" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    Vue学习笔记5 |  路修远
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

<link rel="alternate" href="/atom.xml" title="路修远" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Vue学习笔记5"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Vue学习笔记5
</h1>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/05/17/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05/" class="article-date">
  <time datetime="2021-05-17T02:54:31.000Z" itemprop="datePublished">2021-05-17</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a> / <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/Vue/">Vue</a> / <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/Vue/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">3.8k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">14 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>Vue2.x学习笔记。原视频教程：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV15741177Eh">最全最新Vue、Vuejs教程，从入门到精通_哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></p>
<p>第五部分：Vuex。</p>
</blockquote>
<br>

<h1 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h1><h2 id="认识Vuex"><a href="#认识Vuex" class="headerlink" title="认识Vuex"></a>认识Vuex</h2><p>官方解释：Vuex 是一个专为 Vue.js 应用程序开发的<strong>状态管理模式</strong>。</p>
<ul>
<li><p>它采用 集中式存储管理 应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。</p>
</li>
<li><p>Vuex 也集成到 Vue 的官方调试工具 <a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-devtools">devtools</a><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-devtools"> extension</a>，提供了诸如零配置的 time-travel 调试、状态快照导入导出等高级调试功能。</p>
</li>
</ul>
<p><strong>状态管理</strong>到底是什么？</p>
<ul>
<li><p><strong>状态管理模式、集中式存储管理</strong>这些名词听起来就非常高大上，让人捉摸不透。</p>
</li>
<li><p>其实，你可以简单的将其看成把需要多个组件共享的变量全部存储在一个对象里面。</p>
</li>
<li><p>然后，将这个对象放在顶层的Vue实例中，让其他组件可以使用。</p>
</li>
<li><p>那么，多个组件是不是就可以共享这个对象中的所有变量属性了呢？</p>
</li>
</ul>
<p>等等，如果是这样的话，为什么官方还要专门出一个插件Vuex呢？难道我们不能自己封装一个对象来管理吗？</p>
<ul>
<li><p>当然可以，只是我们要先想想VueJS带给我们最大的便利是什么呢？没错，就是响应式。</p>
</li>
<li><p>如果你自己封装实现一个对象能不能保证它里面所有的属性做到响应式呢？当然也可以，只是自己封装可能稍微麻烦一些。</p>
</li>
<li><p>不用怀疑，Vuex就是为了提供这样一个在多个组件间共享状态的插件，用它就可以了。</p>
</li>
</ul>
<p>但是，有什么状态时需要我们在多个组件间共享的呢？</p>
<ul>
<li><p>如果你做过大型开放，你一定遇到过多个状态，在多个界面间的共享问题。</p>
</li>
<li><p>比如用户的登录状态、用户名称、头像、地理位置信息等等。</p>
</li>
<li><p>比如商品的收藏、购物车中的物品等等。</p>
</li>
<li><p>这些状态信息，我们都可以放在统一的地方，对它进行保存和管理，而且它们还是响应式的。</p>
</li>
</ul>
<h2 id="单界面的状态管理"><a href="#单界面的状态管理" class="headerlink" title="单界面的状态管理"></a>单界面的状态管理</h2><p>我们知道，要在单个组件中进行状态管理是一件非常简单的事情</p>
<p>什么意思呢？我们来看下面的图片。</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511141608547.png" alt="image-20210511141608547"></p>
<p>这图片中的三种东西，怎么理解呢？</p>
<ul>
<li><p>State：不用多说，就是我们的状态。（你姑且可以当做就是data中的属性）</p>
</li>
<li><p>View：视图层，可以针对State的变化，显示不同的信息。（这个好理解吧？）</p>
</li>
<li><p>Actions：这里的Actions主要是用户的各种操作：点击、输入等等，会导致状态的改变。</p>
</li>
</ul>
<p><strong>写点代码，加深理解：</strong></p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511141642353.png" alt="image-20210511141642353"></p>
<ul>
<li><p>在这个案例中，我们有木有状态需要管理呢？没错，就是个数counter。</p>
</li>
<li><p>counter需要某种方式被记录下来，也就是我们的State。</p>
</li>
<li><p>counter目前的值需要被显示在界面中，也就是我们的View部分。</p>
</li>
<li><p>界面发生某些操作时（我们这里是用户的点击，也可以是用户的input），需要去更新状态，也就是我们的Actions</p>
</li>
</ul>
<h2 id="多界面状态管理"><a href="#多界面状态管理" class="headerlink" title="多界面状态管理"></a>多界面状态管理</h2><p>Vue已经帮我们做好了单个界面的状态管理，但是如果是多个界面呢？</p>
<ul>
<li><p>多个试图都依赖同一个状态（一个状态改了，多个界面需要进行更新）</p>
</li>
<li><p>不同界面的Actions都想修改同一个状态（Home.vue需要修改，Profile.vue也需要修改这个状态）</p>
</li>
</ul>
<p>也就是说对于某些状态(状态1/状态2/状态3)来说只属于我们某一个试图，但是也有一些状态(状态a/状态b/状态c)属于多个试图共同想要维护的</p>
<ul>
<li><p>状态1/状态2/状态3你放在自己的房间中，你自己管理自己用，没问题。</p>
</li>
<li><p>但是状态a/状态b/状态c我们希望交给一个大管家来统一帮助我们管理！！！</p>
</li>
<li><p>没错，Vuex就是为我们提供这个大管家的工具。</p>
</li>
</ul>
<p>全局单例模式（大管家）</p>
<ul>
<li><p>我们现在要做的就是将共享的状态抽取出来，交给我们的大管家，统一进行管理。</p>
</li>
<li><p>之后，你们每个试图，按照我<strong>规定好的</strong>规定，进行访问和修改等操作。</p>
</li>
<li><p>这就是Vuex背后的基本思想。</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511142902027.png" alt="image-20210511142902027"></p>
</li>
</ul>
<br>

<h2 id="Vuex基本使用"><a href="#Vuex基本使用" class="headerlink" title="Vuex基本使用"></a>Vuex基本使用</h2><h3 id="0-安装："><a href="#0-安装：" class="headerlink" title="0. 安装："></a>0. 安装：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex -<span class="literal">-save</span></span><br></pre></td></tr></table></figure>


<h3 id="1-提取公共store对象，保存共享状态"><a href="#1-提取公共store对象，保存共享状态" class="headerlink" title="1. 提取公共store对象，保存共享状态"></a>1. 提取公共store对象，保存共享状态</h3><p>首先，我们需要在某个地方存放我们的Vuex代码：</p>
<p>这里，我们先创建一个文件夹store，并且在其中创建一个index.js文件</p>
<p>在index.js文件中写入如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//需要共享的状态</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>


<h3 id="2-挂载到Vue实例中"><a href="#2-挂载到Vue实例中" class="headerlink" title="2. 挂载到Vue实例中"></a>2. 挂载到Vue实例中</h3><p>其次，我们让所有的Vue组件都可以使用这个store对象</p>
<ul>
<li><p>来到main.js文件，导入store对象，并且放在new Vue中</p>
</li>
<li><p>这样，在其他Vue组件中，我们就可以通过<code>this.$store</code>的方式，获取到这个store对象了</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Vue.config.productionTip = false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="3-使用store对象"><a href="#3-使用store对象" class="headerlink" title="3. 使用store对象"></a>3. 使用store对象</h3><p>在其他组件中使用store对象中保存的状态即可</p>
<ul>
<li><p>通过<code>this.$store.state.</code>属性的方式来访问状态</p>
</li>
<li><p>通过<code>this.$store.commit(&#39;mutation中方法&#39;)</code>来修改状态</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511212937362.png" alt="image-20210511212937362"></p>
<br>

</li>
</ul>
<h2 id="Vuex核心概念"><a href="#Vuex核心概念" class="headerlink" title="Vuex核心概念"></a>Vuex核心概念</h2><h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><p>Vuex提出使用单一状态树, 什么是单一状态树呢？</p>
<ul>
<li>英文名称是Single Source of Truth，也可以翻译成单一数据源。</li>
</ul>
<p>但是，它是什么呢？我们用一个生活中的例子做一个简单的类比：</p>
<ul>
<li><p>我们知道，在国内我们有很多的信息需要被记录，比如上学时的个人档案，工作后的社保记录，公积金记录，结婚后的婚姻信息，以及其他相关的户口、医疗、文凭、房产记录等等（还有很多信息）。</p>
</li>
<li><p>这些信息被分散在很多地方进行管理，有一天你需要办某个业务时(比如入户某个城市)，你会发现你需要到各个对应的工作地点去打印、盖章各种资料信息，最后到一个地方提交证明你的信息无误。</p>
</li>
<li><p>这种保存信息的方案，不仅仅低效，而且不方便管理，以及日后的维护也是一个庞大的工作(需要大量的各个部门的人力来维护，当然国家目前已经在完善我们的这个系统了)。</p>
</li>
</ul>
<p>这个和我们在应用开发中比较类似：</p>
<ul>
<li><p>如果你的状态信息是保存到多个Store对象中的，那么之后的管理和维护等等都会变得特别困难。</p>
</li>
<li><p>所以Vuex也使用了单一状态树来管理应用层级的全部状态。</p>
</li>
<li><p>单一状态树能够让我们最直接的方式找到某个状态的片段，而且在之后的维护和调试过程中，也可以非常方便的管理和维护。</p>
</li>
</ul>
<br>

<h3 id="Getters"><a href="#Getters" class="headerlink" title="Getters"></a>Getters</h3><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><p>有时候，我们需要从store中获取一些state变异后的状态，比如下面的Store中：</p>
<ul>
<li><p>获取学生年龄大于20的个数:</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511202746585.png" alt="image-20210511202746585"></p>
</li>
<li><p>我们可以在Store中定义getters</p>
<ul>
<li>组件中使用computed：</li>
</ul>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511202805764.png" alt="image-20210511202805764"></p>
<ul>
<li>store中使用getters：</li>
</ul>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516110703551.png" alt="image-20210516110703551"></p>
</li>
</ul>
<h4 id="作为参数和传递参数"><a href="#作为参数和传递参数" class="headerlink" title="作为参数和传递参数"></a>作为参数和传递参数</h4><p>如果我们已经有了一个获取所有年龄大于20岁学生列表的getters, 那么代码可以这样来写：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511202908093.png" alt="image-20210511202908093"></p>
<p>getters默认是不能传递参数的, 如果希望传递参数, 那么只能让getters本身返回另一个函数。</p>
<ul>
<li><p>比如上面的案例中,我们希望根据ID获取用户的信息</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210511202940683.png" alt="image-20210511202940683"></p>
</li>
</ul>
<br>

<h3 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h3><p>Vuex的store状态的更新唯一方式：<strong>提交Mutation</strong></p>
<h4 id="Mutation状态更新"><a href="#Mutation状态更新" class="headerlink" title="Mutation状态更新"></a>Mutation状态更新</h4><p><strong>Mutation主要包括两部分：</strong></p>
<ul>
<li><p>字符串的<strong>事件类型</strong>（type）</p>
</li>
<li><p>一个<strong>回调函数</strong>（handler），该回调函数的第一个参数就是state。</p>
</li>
</ul>
<p><strong>mutation的定义方式：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//store.vue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count:<span class="number">100</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//定义方法</span></span><br><span class="line">    mutations: &#123;</span><br><span class="line">        <span class="function"><span class="title">increment</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            state.count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>通过mutation更新：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//App.vue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&lt;button @click=&quot;addition&quot;&gt;+&lt;/button&gt;</span></span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">addition</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">//提交mutation方法</span></span><br><span class="line">        <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="Mutation传递参数"><a href="#Mutation传递参数" class="headerlink" title="Mutation传递参数"></a>Mutation传递参数</h4><p>在通过mutation更新数据的时候, 有可能我们希望携带一些<strong>额外的参数</strong>。参数被称为是mutation的载荷(Payload)。</p>
<p><strong>一个参数：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mutation中定义</span></span><br><span class="line"><span class="function"><span class="title">decrement</span>(<span class="params">state, n</span>)</span> &#123;</span><br><span class="line">    state.count -= n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//methods中提交</span></span><br><span class="line"><span class="function"><span class="title">subtraction</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;decrement&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>多个参数：</strong></p>
<p>这个时候, 我们通常会以对象的形式传递, 也就是payload是一个对象。这个时候可以再从对象中取出相关的信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">changeCount</span>(<span class="params">state, payload</span>)</span> &#123;</span><br><span class="line">    state.count = payload.count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">changeCount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;changeCount&#x27;</span>, &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Mutation提交风格"><a href="#Mutation提交风格" class="headerlink" title="Mutation提交风格"></a>Mutation提交风格</h4><p>上面的通过<strong>commit</strong>进行提交是一种普通的方式。Vue还提供了另外一种风格, 它是一个包含type属性的对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$store.commit(&#123;</span><br><span class="line">    type: <span class="string">&#x27;changeCount&#x27;</span>,</span><br><span class="line">    count: <span class="number">100</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Mutation中的处理方式是<strong>将整个commit的对象作为payload使用,</strong> 所以代码没有改变, 依然如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">changeCount</span>(<span class="params">state,payload</span>)</span> &#123;</span><br><span class="line">    state.count = payload.count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Mutation响应规则"><a href="#Mutation响应规则" class="headerlink" title="Mutation响应规则"></a>Mutation响应规则</h4><p>Vuex的store中的state是响应式的, 当state中的数据发生改变时, Vue组件会自动更新。</p>
<blockquote>
<p>state中的这些属性都会被加入到响应式系统中，而响应式系统会监听属性的变化，当属性发生变化时，会通知所有界面中应用到这些属性的地方，让界面发生刷新。</p>
</blockquote>
<p>这就要求我们必须遵守一些Vuex对应的规则:</p>
<ul>
<li><p>提前在store中初始化好所需的属性。</p>
</li>
<li><p>当给state中的对象添加新属性时, 使用下面的方式:</p>
<ul>
<li>方式一: 使用<code>Vue.set(obj, &#39;newProp&#39;, 123)</code></li>
<li>方式二: 用新对象给旧对象重新赋值</li>
</ul>
<p>我们来看一个例子:</p>
</li>
</ul>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516153453053.png" alt="image-20210516153453053"></p>
<p>当我们点击更新信息时, 界面并没有发生对应改变。</p>
<p>如何才能让它改变呢?</p>
<p>查看下面代码的方式一和方式二，都可以让state中的属性是响应式的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mutation: &#123;</span><br><span class="line">  <span class="function"><span class="title">updateInfo</span>(<span class="params">state,payload</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//state.info[&#x27;height&#x27;] = payload.height</span></span><br><span class="line">    <span class="comment">//方式一：Vue.set()</span></span><br><span class="line">    Vue.set(state.info, <span class="string">&#x27;height&#x27;</span>, payload.height)</span><br><span class="line">    <span class="comment">//方式二：给info赋值一个新对象</span></span><br><span class="line">    state.info = &#123;...state.info, <span class="string">&#x27;height&#x27;</span>: payload.height&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Mutation的类型常量"><a href="#Mutation的类型常量" class="headerlink" title="Mutation的类型常量"></a>Mutation的类型常量</h4><p>我们来考虑下面的问题:</p>
<ul>
<li><p>在mutation中, 我们定义了很多事件类型(也就是其中的方法名称)。</p>
</li>
<li><p>当我们的项目增大时, Vuex管理的状态越来越多, 需要更新状态的情况越来越多, 那么意味着Mutation中的方法越来越多。</p>
</li>
<li><p>方法过多, 使用者需要花费大量的经历去记住这些方法, 甚至是多个文件间来回切换, 查看方法名称, 甚至如果不是复制的时候, 可能还会出现写错的情况。</p>
</li>
</ul>
<p>如何避免上述的问题呢?</p>
<ul>
<li><p>在各种Flux实现中, 一种很常见的方案就是使用<strong>常量</strong>替代Mutation<strong>事件的类型</strong>。</p>
</li>
<li><p>我们可以将这些常量放在一个单独的文件中, 方便管理以及让整个app所有的事件类型一目了然。</p>
</li>
</ul>
<p>具体怎么做呢?</p>
<ul>
<li><p>我们可以创建一个文件: mutation-types.js, 并且在其中定义我们的常量：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516154750796.png" alt="image-20210516154750796"></p>
</li>
<li><p>定义常量时, 我们可以使用ES2015中的风格, 使用一个常量来作为函数的名称：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516154904202.png" alt="image-20210516154904202"></p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516155008857.png" alt="image-20210516155008857"></p>
</li>
</ul>
<h4 id="Mutation同步函数"><a href="#Mutation同步函数" class="headerlink" title="Mutation同步函数"></a>Mutation同步函数</h4><p>通常情况下, Vuex要求我们Mutation中的方法必须是同步方法。</p>
<p>主要的原因是当我们使用devtools时, 可以devtools可以帮助我们捕捉mutation的快照。但是如果是异步操作, 那么devtools将不能很好的追踪这个操作什么时候会被完成。</p>
<p>比如：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516155653578.png" alt="image-20210516155653578"></p>
<p>你会发现state中的info数据一直没有被改变, 因为他无法追踪到。</p>
<p><strong>So，通常情况下不要在mutation中进行异步的操作。</strong></p>
<br>

<h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><h4 id="基本定义"><a href="#基本定义" class="headerlink" title="基本定义"></a>基本定义</h4><p>我们强调, 不要在Mutation中进行异步操作。</p>
<p>但是某些情况, 我们确实希望在Vuex中进行一些异步操作, 比如网络请求, 必然是异步的。这个时候怎么处理呢?</p>
<p>Action类似于Mutation, 但是是用来代替Mutation进行异步操作的。</p>
<p>Action的基本使用代码如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        <span class="function"><span class="title">increment</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            state.count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        <span class="function"><span class="title">increment</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">            context.commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>context是什么？</p>
<ul>
<li><p>context是和store对象具有相同方法和属性的对象。</p>
</li>
<li><p>也就是说, 我们可以通过context去进行commit相关的操作, 也可以获取<code>context.state</code>等。</p>
</li>
<li><p>但是注意, 这里它们并不是同一个对象, 为什么呢? 我们后面学习Modules的时候, 再具体说。</p>
</li>
</ul>
<p>我们定义了actions,，然后又在actions中去进行commit，这样的代码是否多此一举呢？事实上并不是这样, 如果在Vuex中有异步操作, 那么我们就可以在actions中完成了。</p>
<h4 id="Action的分发"><a href="#Action的分发" class="headerlink" title="Action的分发"></a>Action的分发</h4><p>在Vue组件中, 如果我们调用action中的方法, 那么就需要使用<code>dispatch</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的, 也是支持传递payload：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;increment&#x27;</span>, &#123;<span class="attr">cCount</span>: <span class="number">5</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">    <span class="function"><span class="title">increment</span>(<span class="params">state,payload</span>)</span> &#123;</span><br><span class="line">        state.count += payload.cCount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">actions: &#123;</span><br><span class="line">    <span class="function"><span class="title">increment</span>(<span class="params">context, payload</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            context.commit(<span class="string">&#x27;increment&#x27;</span>, payload)</span><br><span class="line">        &#125;, <span class="number">5000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Action返回的Promise"><a href="#Action返回的Promise" class="headerlink" title="Action返回的Promise"></a>Action返回的Promise</h4><p>在Action中, 我们可以将异步操作放在一个Promise中, 并且在成功或者失败后, 调用对应的resolve或reject：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516162032798.png" alt="image-20210516162032798"></p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516162045532.png" alt="image-20210516162045532"></p>
<br>

<h3 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h3><p>Module是模块的意思, 为什么在Vuex中我们要使用模块呢？</p>
<p>Vue使用单一状态树，那么也意味着很多状态都会交给Vuex来管理。</p>
<p>当应用变得非常复杂时，store对象就有可能变得相当臃肿。</p>
<p>为了解决这个问题，Vuex允许我们将store分割成模块(Module), 而每个模块拥有自己的state、mutation、action、getters等。</p>
<p>我们按照什么样的方式来组织模块呢? 我们来看下边的代码：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516164421460.png" alt="image-20210516164421460"></p>
<p>上面的代码中, 我们已经有了整体的组织结构, 下面我们来看看具体的<strong>局部模块</strong>中的代码如何书写。</p>
<ul>
<li><p>我们在moduleA中添加state、mutations、getters</p>
</li>
<li><p>mutation和getters接收的第一个参数是局部状态对象</p>
</li>
</ul>
<img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516164711983.png" alt="image-20210516164711983" style="zoom:120%;">

<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516164718935.png" alt="image-20210516164718935"></p>
<blockquote>
<p>注意：</p>
<p>虽然，我们的doubleCount和increment都是定义在对象内部的，但是在调用的时候, 依然是通过this.$store来直接调用的。</p>
</blockquote>
<h4 id="Actions的写法"><a href="#Actions的写法" class="headerlink" title="Actions的写法"></a>Actions的写法</h4><p>actions的写法呢？ 接收一个context参数对象，局部状态通过 <code>context.state</code> 暴露出来，根节点状态则为 <code>context.rootState</code>：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516165632074.png" alt="image-20210516165632074"></p>
<p>如果getters中也需要使用全局的状态, 可以接受更多的参数：</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516165702983.png" alt="image-20210516165702983"></p>
<br>

<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>当我们的Vuex帮助我们管理过多的内容时, 好的项目结构可以让我们的代码更加清晰。</p>
<p><img src="https://gitee.com/W-alker/picgo/raw/master/vue_snap/image-20210516165938927.png" alt="image-20210516165938927"></p>
<br> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>Copyright： </strong>
          
          Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2021/05/17/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2021/05/17/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            Vue学习笔记6
          
        </div>
      </a>
    
    
      <a href="/2021/05/17/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Vue学习笔记4</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "DxjdVENjKn4OPt6wHb07UtxP-gzGzoHsz",
    app_key: "J0hPK8lUjl1jMLcupB2S7Gws",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2021
        <i class="ri-heart-fill heart_icon"></i> Lu xiuyuan
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="路修远"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/12/30/%E6%95%A3%E8%AF%97">诗集</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->


<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


<script src="/js/dz.js"></script>



    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=28718313&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
  </div>
</body>

</html>